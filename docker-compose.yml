version: '3.8'

services:
  cem4dgs:
    build:
      context: .
      args:
        - TORCH_CUDA_ARCH_LIST=${TORCH_CUDA_ARCH_LIST:-8.6 8.9 12.0+PTX}
    user: "${UID}:${GID}"
    image: cem4dgs:latest
    runtime: nvidia
    environment:
      # Use GPU_ID to select specific GPU (e.g., GPU_ID=3)
      - NVIDIA_VISIBLE_DEVICES=${GPU_ID:-all}
      # Fix for getpass.getuser() failing on non-existent UID
      - USER=${USER:-user}
      - HOME=/tmp
      - TORCH_HOME=/cache/torch
    volumes:
      # Mount dataset directory
      - ${DATASET_PATH:-/data/projects/nerf_data}:/data
      # Mount current directory for code execution and output
      - .:/app
      # Persistent cache for weights (PyTorch, etc.)
      - ./cache:/cache
    stdin_open: true
    tty: true
    command: /bin/bash
